<div>
<span><div><span style="font-weight: bold;"><font style="font-size: 14pt;">Introduction</font></span><br/></div><div>Continuous Integration/Continuous Deployment - Is the term when we have automated builds/deployments for our Applications.</div><div><br/></div><div>    In this article, I will show you how I created my own Jenkins Server that automatically builds when I commit to a Git Repository, pushes Image to Docker, logs in to my AWS LightSail Server and deployments any changes immediately! Including this article! My Jenkins Server is running on my local machine (my personal PC) and it automatically uploads to this site you are reading this article on! (<a
        href="http://sysdotoutdotprint.com/">http://sysdotoutdotprint.com/</a>)</div><div><br/></div><div>    I noticed that every time I make changes for my website I keep doing the same steps;</div><div><ol><li><span
        style="font-size: 10pt;">Push Changes to Repository</span></li><li><span style="font-size: 10pt;">Build 2 Local Images (Node + React App, see architecture of this site for more details)</span></li><li><span
        style="font-size: 13.3333px;">Push these images to Docker Repository</span></li><li><span
        style="font-size: 13.3333px;">Login to AWS</span></li><li><span style="font-size: 13.3333px;">Pull images from AWS</span></li><li><span
        style="font-size: 13.3333px;">Stop running containers</span></li><li><span style="font-size: 13.3333px;">Start new Containers based on new images</span></li></ol><div><span
        style="font-size: 13.3333px;"><br/></span></div></div><div><span style="font-size: 13.3333px;">These steps are very tedious, and it prevents me from focusing on writing quality stuff.</span></div><div><br/></div><div><span
        style="font-weight: bold;">Prerequisites</span></div><div><ul><li>Knowledge of Docker</li></ul><div><br/></div><div><span
        style="font-weight: bold;">Pipeline</span></div></div><div><img src="../../src/img/57_files/Image.png"
                                                                        type="image/png"
                                                                        data-filename="Image.png"
                                                                        style="font-weight: bold;"/></div><div><br/></div><div>Based on the steps above, here are the three main sections that composes of our pipeline:</div><div><ul><li>Build Local - Checks Git Repository and polls if there are any commits, if yes trigger the build pipeline and run the build commands</li><li>Docker Push - This just involves uploading images to our docker repository</li><li>Upload to EC2 - this step involves checking/stopping running EC2 in our AWS servers, pull the latest image from the repo, and run new instances.</li></ul><div><br/></div></div><div><span
        style="font-weight: bold;">Installation</span><br/></div><div>Installing Jenkins via Docker:</div><div><span
        style="color: rgb(117, 117, 117); font-style: italic;">docker run -u root --restart unless-stopped -d -p 8081:8080 -p 50000:50000 -v jenkins-data:/var/jenkins_home -v /var/run/docker.sock:/var/run/docker.sock jenkinsci/blueocean</span><br/></div><div><br/></div><div>Running Jenkins for Docker is very easy just execute the command above. Noticing the flags:</div><div><ul><li>--restart unless-stopped - this will make sure that Jenkins is always running on your local instance.</li><li>8081:8080 - we are exposing the port of docker port 8080 as port 8081, this is so it does not coincide with other ports running on your local machine (you can always change this to whatever port you want)</li><li><span
        style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: &quot;Segoe UI&quot;; font-style: italic; font-variant-caps: normal; font-variant-ligatures: normal;">-v jenkins-data:/var/jenkins_home -v /var/run/docker.sock:/var/run/docker.sock -</span> <span
        style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: &quot;Segoe UI&quot;; font-variant-caps: normal; font-variant-ligatures: normal;">finally we are mounting the volume to an external volume, this is so that when you do restart or drop the container, we are retaining any config files we have saved for our local config</span></li></ul><div><span
        style="font-style: italic;">You should be able to hit localhost:8081 for your Jenkins server at this point</span><br/></div><div><br/></div><div><span
        style="font-weight: bold;"><font style="font-size: 14pt;">Plugins:</font></span></div><div>Jenkins mostly is dependent on its plugins, at the very core of it you should be execute just shell commands, plugins can be installed under &quot;Manage </div><div>Jenkins&quot; &gt; &quot;Manage Plugins&quot; &gt; &quot;Available&quot;, Here are the plugins I used for above mentioned pipeline (in addition the standard plugins Jenkins use):</div><div><br/></div><div><ul><li>Amazon EC2 Container Service Plugin</li><li>Amazon EC2 Plugin</li><li>Build Pipeline Plugin</li><li>Pipeline</li><li>Publish Over SSH</li><li>SSH Agent Plugin</li><li>SSH Credentials Plugin</li><li>SSH Plugin</li><li>SSH Slaves</li></ul></div><div><font
        style="font-size: 14pt;"><br/></font></div></div><div><span style="font-weight: bold;"><font
        style="font-size: 14pt;">Step 1 - Build Local</font></span></div><div>Once plugins are installed, Create Free Style Project:</div><div><img
        src="../../src/img/57_files/Image [1].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>First Step is to add your Git Repository, and add your credentials, </div><div>Build Triggers, Poll SCM - is a cron job that states how often will Jenkins check your repository for any commits. See Cron Job syntax for format, for this example we are using * * * * * </div><div><img
        src="../../src/img/57_files/Image [2].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>Scroll down further and look at build, these are the shell commands I execute to run and build my application, it can be totally different on your side, it can be a maven build, gradle build, ant build whatever your application requires. This is where the plugins would come in. To execute maven commands or other commands. but executing in shell is always available</div><div><img
        src="../../src/img/57_files/Image [3].png" type="image/png" data-filename="Image.png"/></div><div>At this point you might not be able to set Post-Build Actions as you have just created one job, but essentially this is where you state which next job you want to run. so for this instance, after building my application I want to push it to Docker hub.</div><div><br/></div><div><span
        style="text-decoration: underline;">Link Step 1 to Step 2 via post build actions</span></div><div><b><font
        style="font-size: 14pt;">Step 2 - Docker Push</font></b></div><div>Create a new job/item as a free style project as well.  This step is fairly simple under the build I just put, this is the step that  actually pushes the image to docker hub.</div><div><br/></div><div>docker push mel3kings/nodesysoutprint:latest</div><div>docker push mel3kings/sysdotoutdotprint:latest</div><div><br/></div><div>So, for you to push to docker, you need to login in first. Jenkins is running on Docker, but inside Jenkins you can still execute Docker commands, so you can enter jenkins via:</div><div>docker exec -it &lt;container_name&gt; bash</div><div><br/></div><div>from here, you can run </div><div><i>docker login</i></div><div><i><br/></i></div><div><u>Link Step 2 to Step 3 via post build actions</u></div><div><i><b><font
        style="font-size: 16pt;"><br/></font></b></i></div><div><b><font
        style="font-size: 14pt;">Step 3 - upload to EC2</font></b></div><div>This is where it gets a bit tricky, so basically you are automating first how you SSH to your server. You will need your private key you use to SSH to your server. and save that detail to your Jenkins Server, here's how:</div><div>Go Manage Jenkins &gt; Configure System &gt; Scroll Down</div><div><br/></div><div>You should see a SSH remote hosts section (look for it in the plugin if not), Credentials would require your private key as well</div><div><br/></div><div><img
        src="../../src/img/57_files/Image [4].png" type="image/png" data-filename="Image.png"/></div><div><b><br/></b></div><div><b>SSH Credentials - Username with private key</b></div><div>Enter private key here and the ec2user</div><div><img
        src="../../src/img/57_files/Image [5].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>Finally, create another item/job, and at the build part select Execute Shell Script on Remote host using SSH (Again this is via installed plugin)</div><div><br/>
The commands I have are how I pull images and kill all the running services, and run any new ones.</div><div><img
        src="../../src/img/57_files/Image [6].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>And that's it you are done! any push to the git triggers this pipeline and builds, pushes and instantly deploys to my website! Of course your case will be different and might require different steps, but this is the general gist of how you could create your very own CI/CD, even if you are just running a local Jenkins server.</div><div><br/></div><div> </div><div><br/></div><div><br/></div></span>
</div>