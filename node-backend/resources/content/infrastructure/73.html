<div><span><div><span style="font-weight: bold;">What is Salt Stack? </span>Salt Stack is an orchestration tool that can be very useful if you are in a microservices architecture, but need to perform individual command on seperate instances. (or you lack Kubernetes/Helm to orchestrate your releases)</div><div><br/></div><div><br/></div><div><span
        style="font-weight: bold;">How it looks like</span></div><div><img src="../../src/img/73_files/1_tier.png" type="image/png"
                                                                           data-filename="1_tier.png"/><br/></div><div><br/></div><div>Salt stack uses python, hence it works well with python scripts, but you can use other forms of scripting languages as well.</div><div><br/></div><div><span
        style="font-weight: bold;">Installation</span></div><ol><li><div>First is that you need to install salt-stack in your servers via: (in the related Docker article, this is all done in the DockerFile so once you start the instance, it is all installed)</div></li></ol><div
        style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div><span
        style="font-family: Consolas; font-size: 13px; color: rgb(36, 39, 41);">curl -o bootstrap-salt.sh -L </span><a
        href="https://bootstrap.saltstack.com" style="font-family: Consolas; font-size: 13px; color: rgb(36, 39, 41);">https://bootstrap.saltstack.com</a></div></div><ol
        start="2"><li><div>You then need to run a saltstack bootstrap script (this comes with the installation from the curl), and identifying which one is master, and which one is minion</div></li></ol><div>Master:</div><div
        style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>bootstrap-salt.sh -MN</div></div><div> Minion:</div><div
        style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>bootstrap-salt.sh</div></div><div> </div><div>-M flag indicates that this is server is the master, and -N indicates do NOT install minion here. There are other flags as well which you can see here: <a
        href="https://docs.saltstack.com/en/latest/topics/tutorials/salt_bootstrap.html">https://docs.saltstack.com/en/latest/topics/tutorials/salt_bootstrap.html</a></div><div>(Or just google saltstack Bootstrap documentation)</div><div><br/></div><ol
        start="5"><li><div>Make sure that master and minion are on the same network. This can be done by pinging one and see a response</div></li><li><div>Both minion and master need their specific configuration. you need two files: minion and master (yes those are the file names), and need to be placed under /etc/salt or wherever you installed your salt, also the configuration options are quite long to go through one by one, here is an example config, and the documentation: <a
        href="https://docs.saltstack.com/en/latest/ref/configuration/examples.html#configuration-examples-master">https://docs.saltstack.com/en/latest/ref/configuration/examples.html#configuration-examples-master</a></div></li><ul><li><div>Here are the Basic Master configs you need to know:</div></li><ul><li><div>auto_accept: True</div><div>- this accepts all keys sent to the master, which is obviously not recommended in production environment but for testing purpose it will suffice</div></li><li><div><div>log_level: debug</div></div><div>- for debugging</div></li></ul><li><div>For Minion:</div></li><ul><li><div>master: salt-master</div><div>- This is the host name of your master, since I was using Docker, I can just specify salt-master, but in other instances it might need to have ip, or whatever DNS host name you use</div></li><li><div>id: minion-1</div><div>- Id of the minion, this what will appear to master, and how you reference to it</div></li><li><div><div>log_level: debug</div></div><div><div>- for debugging</div></div></li></ul></ul><li><div>You have now installed salt to the servers but now you need to make sure they are able to talk to each other, carry on:</div></li></ol><div><br/></div><div><span
        style="font-weight: bold;">Salt Master-Minion Handshake:</span></div><div>There are several ways to register a salt-minion to a master. By default, when a Salt-Minion starts up it looks for a master in the same network, and it will try to register itself to the master. If you had set autoAccept as true from above it is fine.</div><div><br/></div><div>Otherwise, in master you can execute:</div><div
        style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>salt-key --list-all</div></div><div>This will list out the salt-minions that have been trying to register itself to master</div><div><br/></div><div>You need to then run the following to specify which Key to accept</div><div
        style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>salt-key <span
        style="font-family: Monaco; font-size: 12px; color: rgb(51, 51, 51);">--</span>accept=&lt;public_key&gt;</div></div><div>Or to accept all</div><div
        style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>salt-key --accept-all</div></div><div><br/></div><div><b>How to test it:</b><br/></div><div>I’ve created a DockerFile for setting up a salt-master/salt-minion. See related article on the break down of Dockerrizing Salt.</div><div><br/></div><div
        style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>$ docker ps</div><div>CONTAINER ID        IMAGE                   COMMAND                  CREATED              STATUS              PORTS               NAMES</div><div>49df015e54b1        mel3kings/salt-minion   &quot;salt-minion -l debug&quot;   About a minute ago   Up About a minute                       salt-minion</div><div>198559bf11cf        mel3kings/salt-master   &quot;salt-master -l debug&quot;   20 hours ago         Up About a minute                       salt-master</div></div><div><br/></div><div><br/></div><div><span
        style="font-weight: bold;">Salt Command Format:</span></div><div
        style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>salt '&lt;which_minion&gt;' &lt;command&gt;</div></div><div></div><div><br/></div><div>Testing ping: <br/></div><div
        style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>salt ‘*’ test.ping</div></div><ul><li><div>* asterisk in this case is ALL the minion</div></li><li><div>test.ping is an execution module built in Salt for the full list: <a
        href="https://docs.saltstack.com/en/latest/ref/modules/all/index.html">https://docs.saltstack.com/en/latest/ref/modules/all/index.html</a></div></li></ul><div><img
        src="../../src/img/73_files/Screen Shot 2018-04-19 at 11.53.28 am.png" type="image/png"
        data-filename="Screen Shot 2018-04-19 at 11.53.28 am.png" width="647"/></div><div><br/></div><div>Another good example is running a remote python script:</div><div
        style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>salt 'minion-1' cmd.run 'python /etc/salt/run.py 1 2'</div></div><div><img
        src="../../src/img/73_files/Screen Shot 2018-04-19 at 11.59.50 am.png" type="image/png"
        data-filename="Screen Shot 2018-04-19 at 11.59.50 am.png"/></div><div><br/></div><div>More Examples, executing commands as if you are in the minion itself:</div><div
        style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>salt 'minion-1' cmd.run pwd</div><div>salt 'minion-1' cmd.run 'ps -ef | grep python'</div></div><div><img
        src="../../src/img/73_files/Screen Shot 2018-04-19 at 12.02.41 pm.png" type="image/png"
        data-filename="Screen Shot 2018-04-19 at 12.02.41 pm.png"/></div><div><br/></div><div>This enables you to have one central system to execute your commands. This is especially useful if you have alot of minions or microservices that need some level of manual management</div></span>
</div>